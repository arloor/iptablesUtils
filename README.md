# åˆ©ç”¨iptablesè®¾ç½®ç«¯å£è½¬å‘çš„shellè„šæœ¬

> ç”¨è¿™å‡ ä¸ªè„šæœ¬ä¸æ”¶è´¹ï¼Œæ‰€ä»¥è¯·å¤§å®¶ä¸è¦è§‰å¾—æˆ‘æœ‰ä¹‰åŠ¡è§£ç­”è„šæœ¬ä½¿ç”¨çš„é—®é¢˜ã€‚æœ‰é—®é¢˜è¯·æissueï¼Œè¯·ä¸è¦é€šè¿‡å…¶ä»–é€”å¾„è”ç³»æˆ‘ï¼Œä¸‹ç­æ—¶é—´ä¸æƒ³è¢«è¿™äº›äº‹æƒ…çƒ¦åˆ°ã€‚

å¾ˆå¤šç©VPSçš„äººéƒ½ä¼šæœ‰è®¾ç½®ç«¯å£è½¬å‘ã€è¿›è¡Œä¸­è½¬çš„éœ€æ±‚ï¼Œåœ¨è¿™æ–¹é¢ä¹Ÿæœ‰è‹¥å¹²ç§æ–¹æ¡ˆï¼Œæ¯”å¦‚socatã€haproxyã€brookç­‰ç­‰ã€‚ä»–ä»¬éƒ½æœ‰ä¸€äº›å±€é™æˆ–è€…é—®é¢˜ï¼Œæ¯”å¦‚socatä¼šçˆ†å†…å­˜ï¼Œhaproxyä¸æ”¯æŒudpè½¬å‘ã€‚

æˆ‘æ¯”è¾ƒå–œæ¬¢iptablesã€‚iptablesåˆ©ç”¨linuxçš„ä¸€ä¸ªå†…æ ¸æ¨¡å—è¿›è¡ŒipåŒ…çš„è½¬å‘ï¼Œå·¥ä½œåœ¨linuxçš„å†…æ ¸æ€ï¼Œä¸æ¶‰åŠå†…æ ¸æ€å’Œç”¨æˆ·æ€çš„çŠ¶æ€è½¬æ¢ï¼Œå› æ­¤å¯ä»¥è¯´æ˜¯æ‰€æœ‰ç«¯å£è½¬å‘æ–¹æ¡ˆä¸­æ€§èƒ½æœ€å¥½ã€æœ€ç¨³å®šçš„ã€‚ä½†ä»–çš„ç¼ºç‚¹ä¹Ÿæ˜¾è€Œæ˜“è§ï¼šåªæ”¯æŒIPã€éœ€è¦è¾“å…¥ä¸€å¤§å †å‚æ•°ã€‚æœ¬é¡¹ç›®å°±æ˜¯ä¸ºäº†è§£å†³è¿™äº›ç¼ºç‚¹ï¼Œè®©å¤§å®¶èƒ½æ–¹ä¾¿å¿«é€Ÿåœ°ä½¿ç”¨æœ€å¿«ã€æœ€ç¨³å®šçš„ç«¯å£è½¬å‘æ–¹æ¡ˆã€‚

|è„šæœ¬|åŠŸèƒ½|ä¼˜åŠ¿|é™åˆ¶|
|---   |--|--|---|
|iptables.sh|1. å¿«é€Ÿæ–¹ä¾¿åœ°è®¾ç½®æœ¬æœºåˆ°ç›®æ ‡åŸŸå/IPçš„iptablesè½¬å‘<br><br>2. ä»…éœ€è¾“å…¥æœ¬åœ°ç«¯å£å·ã€ç›®æ ‡ç«¯å£å·ã€ç›®æ ‡åŸŸå/IPå³å¯|1. åŸç”Ÿiptablesä»…æ”¯æŒipï¼Œè¯¥è„šæœ¬æ”¯æŒåŸŸåå¹¶<br><br>2. å¦å¤–ï¼Œä»…éœ€è¦ç”¨æˆ·è¾“å…¥ä¸‰ä¸ªå‚æ•°ï¼Œé¿å…äº†å¤æ‚åœ°æ‰‹åŠ¨è°ƒç”¨è¿‡ç¨‹|ä¸èƒ½å¤„ç†ddns(åŸŸåè§£æåœ°ipåœ°å€ä¼šæ”¹å˜çš„æƒ…å†µ)ã€‚<br><br>å¤„ç†ddnsè¯·ä½¿ç”¨ä¸‹é¢ä¸¤æ ä»‹ç»çš„è„šæœ¬|
|dnat-install.sh|è®¾ç½®åˆ°ddnsåŸŸåçš„åŠ¨æ€è½¬å‘è§„åˆ™|èƒ½æ­£ç¡®å¤„ç†ç›®æ ‡åŸŸåå¯¹åº”çš„IPä¼šå˜çš„æƒ…å†µ(ddns)|å°šæœªå‘ç°é—®é¢˜ï¼Œå¦‚æœ‰é—®é¢˜è¯·å‘issue|
|rmPreNatRule.sh|åˆ é™¤æœ¬æœºæŸç«¯å£ä¸Šçš„iptablesè½¬å‘è§„åˆ™|ä»…éœ€è¦è¾“å…¥ç«¯å£å·å³å¯|æ— |

> PS: `dnat-install.sh`æ˜¯å…¨æ–°æ¨å‡ºçš„ddnsè½¬å‘æ–¹æ¡ˆï¼Œç”¨äºä»£æ›¿ä¹‹å‰çš„setCroniptablesDDNSè„šæœ¬ï¼Œcentosç³»å’Œdebainç³»éƒ½å¯ä»¥ä½¿ç”¨è¯¥è„šæœ¬ã€‚å¦‚æœ‰bugï¼Œè¯·æissueğŸ‘

# ç”¨æ³•

# iptables.sh

```shell
wget -O iptables.sh https://raw.githubusercontent.com/arloor/iptablesUtils/master/iptables.sh;bash iptables.sh;
```

# dnat-install.sh
```
wget -O dnat-install.sh https://raw.githubusercontent.com/arloor/iptablesUtils/master/dnat-install.sh
bash dnat-install.sh
```

æŒ‰ç…§è¦æ±‚è¾“å…¥ä¸‰ä¸ªå‚æ•°ï¼šæœ¬åœ°ç«¯å£å·ã€è¿œç¨‹ç«¯å£å·ã€è¿œç¨‹ddnsåŸŸåå³å¯ã€‚è¯¥è„šæœ¬é»˜è®¤å¼€æœºè‡ªå¯åŠ¨ã€‚



# rmPreNatRule.sh

```shell
wget -O rmPreNatRule.sh https://raw.githubusercontent.com/arloor/iptablesUtils/master/rmPreNatRule.sh;bash rmPreNatRule.sh $localport
```


# æ­£åœ¨è¿›è¡Œçš„å·¥ä½œ...

```
wget -O dnat-uninstall.sh https://raw.githubusercontent.com/arloor/iptablesUtils/master/dnat-uninstall.sh
bash dnat-uninstall.sh
```